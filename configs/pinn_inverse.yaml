# Configuration for Feedforward PINN Inverse Training
# FIXED VERSION with correct loss weights for all stages

model_name: pinn
mode: inverse

# Which parameter to estimate
inverse_param: ksi
inverse_init_range: [150, 300]  # Initial search range for ksi

# Model architecture
architecture:
  n_layers: 3
  n_neurons: 30
  activation: tanh
  use_fourier: true
  fourier_features: [0, 1, 2, 3, 4, 5]

# Multi-stage training configuration
training:
  # ========================================================================
  # CRITICAL FIX: All stages MUST include physics losses!
  # Loss weights: [glucose_obs, ode_g, ode_i, ode_d]
  # 
  # Stage 1: Train inverse params with FULL PHYSICS
  # Stage 2: Train NN weights with full physics
  # Stage 3: Joint fine-tuning
  # ========================================================================
  
  stages:
    - name: stage1_params_only
      epochs: 5000
      learning_rate: 1.0e-3
      # CRITICAL: Must include ODE losses for physics guidance!
      loss_weights: [1, 0, 0, 0]
      train_inverse_params: true
      train_nn_weights: false
      optimizer: adam
      display_every: 500
    
    - name: stage2_nn_only
      epochs: 3000
      learning_rate: 5.0e-4
      # Same physics losses
      loss_weights: [5.97, 4.70, 2.71, 3.32]
      train_inverse_params: false
      train_nn_weights: true
      optimizer: adam
      display_every: 500
    
    - name: stage3_joint
      epochs: 2000
      learning_rate: 2.0e-4
      # Same physics losses
      loss_weights: [5.97, 4.70, 2.71, 3.32]
      train_inverse_params: true
      train_nn_weights: true
      optimizer: adam
      display_every: 500
  
  # L-BFGS-B refinement (optional, after all stages)
  use_lbfgs_refinement: false

# Data configuration
data:
  data_dir: data
  source: synthetic
  patient: Pat3
  train_split: 0.9
  mask_interval: 10
  normalize: true

# Output settings
output:
  save_dir: results/pinn_inverse_pat3
  checkpoint_freq: 1000
  log_freq: 500
  save_best_only: false
  wandb_project: null

# Compute settings
device: cpu
seed: 42