# Default Optimisation Configuration
# This file defines default settings for hyperparameter optimisation

# Optimisation mode: 'forward' (RMSE) or 'inverse' (ksi error)
mode: inverse

# Number of trials per architecture
trials:
  total: 300           # Total trials (100 per architecture)
  per_architecture: 100

# Patient split strategy
patients:
  search: 5            # Single patient for hyperparameter search
  validation: [2, 3, 4, 5, 6]  # Validation set
  test: [7, 8, 9, 10, 11]      # Held-out test set

# Optuna sampler settings
sampler:
  type: TPE            # Tree-structured Parzen Estimator
  n_startup_trials: 10 # Random trials before TPE kicks in
  seed: 42

# Pruning settings (early stopping for bad trials)
pruner:
  type: MedianPruner
  n_startup_trials: 5
  n_warmup_steps: 2000
  interval_steps: 500

# Storage settings
storage:
  backend: sqlite      # SQLite for persistence
  db_name: optimisation_study.db

# Output settings
output:
  base_dir: results/optimisation
  export_csv: true
  export_json: true
  save_best_configs: true

# S3 upload settings (optional)
s3:
  enabled: false
  bucket: t1d-pinn-results-900630261719
  region: eu-west-2

# Search space bounds (reference only - actual bounds in search_space.py)
search_space:
  # Architecture parameters
  birnn:
    gru_units: [32, 64, 96, 128]
    n_dense_layers: [1, 2, 3]

  pinn:
    n_layers: [3, 4, 5, 6]
    n_neurons: [20, 30, 40, 50]
    use_fourier: [true, false]

  modified_mlp:
    n_layers: [4, 5, 6, 7]
    n_neurons: [20, 30, 40]
    n_encoders: [2, 3, 4]

  # Curriculum training (inverse mode)
  curriculum:
    stage1_epochs: [2000, 3000, 5000, 8000]
    stage2_epochs: [1000, 2000, 3000, 5000]
    stage3_epochs: [1000, 2000, 3000]
    stage1_lr: [5e-4, 2e-3]  # log scale
    stage2_lr: [1e-4, 1e-3]  # log scale
    stage3_lr: [5e-5, 5e-4]  # log scale

  # Loss weights
  loss_weights:
    birnn:
      lambda_g: [1.0, 15.0]
      lambda_B: [1.0, 12.0]
      lambda_ic: [0.1, 3.0]
    pinn:
      glucose_obs: [1.0, 10.0]
      ode_g: [1.0, 12.0]
      ode_i: [1.0, 12.0]
      ode_d: [0.1, 3.0]

# L-BFGS refinement (DeepXDE models)
lbfgs:
  enabled: true        # Include as searchable option
  epochs: [500, 1000, 2000]

# Validation settings
validation:
  top_k: 3            # Top K configs per model to validate

# Test settings
test:
  top_k: 2            # Top K configs to test for generalisation

# Cost estimation (reference)
cost_estimate:
  gpu_hours_search: 200
  gpu_hours_validation: 10
  gpu_hours_test: 6.5
  spot_price_per_hour: 0.16
  total_estimated_cost: 35  # USD with spot instances
